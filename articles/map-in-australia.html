<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mapping Air Quality in Australia • airpurifyr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mapping Air Quality in Australia">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">airpurifyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/map-in-australia.html">Mapping Air Quality in Australia</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mapping Air Quality in Australia</h1>
            
      

      <div class="d-none name"><code>map-in-australia.Rmd</code></div>
    </div>

    
    
<p>Here we walk through a basic workflow for working with OpenAQ data
inside <code>airpurifyr</code>. The aim is to produce some plots about
the <a href="https://en.wikipedia.org/wiki/2019%E2%80%9320_Australian_bushfire_season" class="external-link">2019-20
Australian Bushfire Season</a>, where air quality was extremely
poor.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://numbats.github.io/airpurifyr/">airpurifyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mdsumner/ozmaps" class="external-link">ozmaps</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://colorspace.R-Forge.R-project.org/" class="external-link">colorspace</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span></code></pre></div>
<p>The first step when working with <code>airpurifyr</code> is to set
your API key. Register your key at <a href="https://explore.openaq.org/register" class="external-link">https://explore.openaq.org/register</a>,
and set this key using <code><a href="../reference/set_openaq_api_key.html">set_openaq_api_key()</a></code>. Note you
<em>can</em> access data without an API key, but it is heavily
restricted, so the package will give you a warning for each query you
run without an API key set.</p>
<p>With your API key set, our first task is to find all the locations on
the east coast of Australia. This is non-trivial, as the “locations”
provided by OpenAQ related to sensors rather than physical locations.
The easiest (but most API intensive) method to get locations is to
download for a large region, and then filter.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_aus_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_measurements_for_location.html">get_measurements_for_location</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="st">"AU"</span>,</span>
<span>  max_observations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  date_from <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>,</span>
<span>  date_to <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-14"</span><span class="op">)</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"pm25"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here, we have asked for data from Australia, from 1 Jan 2020 to 14
Jan 2020, restricted to pm2.5. Restricting the date range and the
parameter means that we need less API calls. Considering we are only
using this data to get a list of stations, the smaller the set the
better.</p>
<p>We recommend using about two weeks of time to get locations, as not
all sensors report on all days.</p>
<p>Next, we filter down these locations using latitude and longitude,
and pull down the data we actually want for a much longer period of
time.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations_of_interest</span> <span class="op">&lt;-</span> <span class="va">all_aus_locations</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># East coast of Australia (roughly)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">long</span> <span class="op">&gt;</span> <span class="fl">141</span>, <span class="va">lat</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">31</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">au_east_coast_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_measurements_for_location.html">get_measurements_for_location</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="st">"AU"</span>,</span>
<span>  location <span class="op">=</span> <span class="va">locations_of_interest</span>,</span>
<span>  max_observations <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  date_from <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2019-12-01"</span><span class="op">)</span>,</span>
<span>  date_to <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-02-01"</span><span class="op">)</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"pm25"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you run this example, you’ll notice this query takes a very long
time. This is because it is quite a few locations for 90 days, with
sensors generally reporting hourly. Here we have increased the
<code>max_observations</code> parameter which makes each query larger
but reduces the number of queries. If you are having troubles with Error
408 (HTTP timeout) then this can be a fix.</p>
<p>The resulting data looks like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">au_east_coast_2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   location_id location parameter value date_utc            unit    lat  long</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        <span style="text-decoration: underline;">2</span>487 Bathurst pm25        9.9 2020-02-01 <span style="color: #949494;">00:00:00</span> µg/m³ -<span style="color: #BB0000;">33.4</span>  150.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        <span style="text-decoration: underline;">2</span>487 Bathurst pm25       10.3 2020-01-31 <span style="color: #949494;">23:00:00</span> µg/m³ -<span style="color: #BB0000;">33.4</span>  150.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        <span style="text-decoration: underline;">2</span>487 Bathurst pm25       10.8 2020-01-31 <span style="color: #949494;">22:00:00</span> µg/m³ -<span style="color: #BB0000;">33.4</span>  150.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        <span style="text-decoration: underline;">2</span>487 Bathurst pm25       11.3 2020-01-31 <span style="color: #949494;">21:00:00</span> µg/m³ -<span style="color: #BB0000;">33.4</span>  150.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        <span style="text-decoration: underline;">2</span>487 Bathurst pm25       12.1 2020-01-31 <span style="color: #949494;">20:00:00</span> µg/m³ -<span style="color: #BB0000;">33.4</span>  150.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        <span style="text-decoration: underline;">2</span>487 Bathurst pm25       12.4 2020-01-31 <span style="color: #949494;">19:00:00</span> µg/m³ -<span style="color: #BB0000;">33.4</span>  150.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: country &lt;chr&gt;</span></span></span></code></pre></div>
<p>We can visualise the stations by looking at their latitude and
longitude from the dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu">ozmaps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ozmaps/man/ozmap_states.html" class="external-link">ozmap_states</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"New South Wales"</span>, <span class="st">"Victoria"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="va">au_east_coast_2020</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">lat</span>, <span class="va">long</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">stations</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Longitude"</span>, y<span class="op">=</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map-in-australia_files/figure-html/unnamed-chunk-2-1.png" width="1152"></p>
<p>You can see that stations are most dense near major cities, with very
little monitoring occurring in regional Australia.</p>
<p>We can look at frequency reporting using a dotplot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">au_east_coast_2020</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_utc</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">location</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"pm2.5"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="map-in-australia_files/figure-html/unnamed-chunk-3-1.png" width="1152"></p>
<p>Here, each set of dots represents one station. You can see that there
are patches of missingness across all stations.</p>
<p>You can also see the effects of the fires, represented by the large
spikes in pm2.5 measurements. According to the <a href="https://www.epa.vic.gov.au/for-community/environmental-information/air-quality/pm25-particles-in-the-air" class="external-link">Victorian
Environmental Protection Authority</a>, pm2.5 levels above 500 (marked
by the dashed line in the previous plot) are considered “extremely
poor”.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jayani P.G. Lakshika, David Wu, Michael Lydeamore.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
